openapi: 3.0.2
info:
  title: Common definitions for Candor Api
  version: 0.9.0
externalDocs:
  description: Changelog
  url: https://github.com/candorfintech/Candor.Api.OpenAPI#changelog
paths:
  /:
    description: See a definition specific specification
components:
  parameters:
    LoanId:
      name: id
      description: The unique identifier for this loan application.
      in: path
      required: true
      example: c8e27489-0381-438f-8148-4b7a2379a64c
      schema:
        $ref: 'schemas.yaml#/components/schemas/LoanId'

  schemas:
    LoanId:
      type: string
      title: LoanId
      description: The unique identifier for this loan application.
      minLength: 1

    Context:
      type: string
      title: Context
      description: A value used by the caller to track the state around this request. If one is supplied, it must be returned as specified.

    LoanDataType:
      type: string
      title: Loan Data Type
      description: |
        The various loan data types that can be associated with the loan.
        - FNM32: Fannie Mae v3.2
        - DUXML: Fannie Mae Desktop Underwriter
        - LPAXML: Loan Product Advisor
        - CREDIT: Credit Provider's Xml (Core Logic)
        - FLOODCERT: Flood Certification (Core Logic)
        - TWNXML: Work Number
        - FINICITY: Verification of assets vendor
        - FRMFREE: Asset Validation
      enum:
      - FNM32
      - DUXML
      - LPAXML
      - CREDIT
      - FLOODCERT
      - TWNXML
      - FINICITY
      - FRMFREE

    StatusType:
      type: string
      enum:
      - Pending
      - Valid
      - Invalid

    UploadDocumentRequest:
      type: object
      title: Upload Document Request
      required:
      - documents
      properties:
        documents:
          type: array
          description: A collection of documents requesting to be uploaded.
          items:
            type: object
            description: Metadata about the document requesting to be uploaded.
              Either the `id`, `filename`, or both must be provided.
            minItems: 1
            properties:
              id:
                type: string
                description: |
                  A unique identifier for this document in the context of this loan. If one is not supplied, one will be created by the Candor Api. It is recommended to stick with the following characters:

                  - `0`-`9`
                  - `a`-`z`
                  - `A`-`Z`
                  - Exclamation point: `!`
                  - Hyphen: `-`
                  - Underscore: `_`
                  - Period: `.`
                  - Asterisk: `*`
                  - Single quote: `'`
                  - Open parentheses: `(`
                  - Close parentheses: `)`
              filename:
                type: string
                description: The filename, e.g., "April Bank Statement.pdf"

    UploadDocumentResponse:
      type: object
      title: Upload Document Response
      required:
      - id
      - documents
      properties:
        id:
          $ref: '#/components/schemas/LoanId'
        documents:
          type: array
          description: A collection of successful or failed document upload requests.
          items:
            type: object
            description: Results of a document upload request. It'll either contain the `upload` location, or an `error`.
            required:
            - id
            properties:
              id:
                type: string
                description: The original `id` supplied in the request if present, or a unique identifier created for this document by the Candor Api.
              error:
                type: string
                description: If an error occurred while trying to complete the upload request for this document, this will contain the error message.
              upload:
                type: object
                required:
                - url
                properties:
                  url:
                    type: string
                    format: uri
                    description: If this document request is valid, this will contain the Url where the document can be uploaded using the `PUT` verb. NOTE, there is an expiration time to this upload url. So it is best to make this request right when you are ready to upload the document.
                  headers:
                    type: object
                    description: Required custom headers that need to be used during the upload PUT request.
                    additionalProperties:
                      type: string

    ProcessLoanBase:
      type: object
      properties:
        responseType:
          type: string
          description: |
            This drives the response type back to the LOS. The system default is `Asynchronous` which can be overridden as a Customer setting, and then additionally overridden here per request.

            - `Asynchronous`: A `202` response will be returned and the body will **not** contain a Candor Result.
            - `Synchronous`: A `200` response will be returned with a Candor Result in the body.

            If `documentsToProcess` are present, the Candor Results of the processed documents will always be an Asynchronous callback notification. If the original request was also `Asynchronous`, then there will only be one Candor Results returned after documents are processed as a callback notification. If the original request was `Synchronous`, then a loan data Candor Result will be returned in the response followed by another Candor Result for the processed documents which be sent as a callback notification.
          default: Asynchronous
          enum:
          - Asynchronous
          - Synchronous
        context:
          $ref: '#/components/schemas/Context'
        emails:
          type: array
          title: Emails
          description: A list of emails to notify when a Candor Result is processed that contained new documents uploaded to the loan.
          items:
            type: object
            required:
            - email
            - type
            properties:
              email:
                type: string
              type:
                type: string
                enum:
                - Processor
                - Underwriter
                - LoanOfficer
        investor:
          type: object
          properties:
            name:
              type: string
            productName:
              type: string
        gse:
          type: string
          enum:
          - FannieMae
          - FreddieMac

    CandorResult:
      type: object
      title: Candor Result
      properties:
        id:
          $ref: '#/components/schemas/LoanId'
        runId:
          type: integer
          description: The number of times that findings have been processed on this loan document
        timestamp:
          type: string
          format: date-time
          description: An ISO-8601 formatted date/time of when this was result was generated
        context:
          $ref: '#/components/schemas/Context'
        ezToClose:
          type: string
          description: Candor Score up to 100 that identifies how hard or easy a loan is to close based on outstanding conditions and their difficulty to obtain. The higher the score the easier to close.
        insuranceCovered:
          type: string
          enum:
          - Pending
          - Available
          - Not Available
        underwritingStatus:
          type: string
          description: Overall underwriting status on the loan document. Note that `Clear to Close` means that all "Candor" related conditions have been cleared on a loan document. There may be "Lender" related conditions for items such as a Credit Inquiry Letter, Title, Mortgage Statement still needed; however, Candor has completed it's analysis of the document.
          enum:
          - Conditional Approval
          - Suspended
          - Declined
          - Clear to Close
        occupancy:
          type: string
          description: Candor analytic related to Occupancy.
          allOf:
          - $ref: '#/components/schemas/StatusType'
        identity:
          type: string
          description: Candor analytic related to Borrower Identity, SSN, etc.
        valuation:
          type: string
          description: Candor analytic related to Property Value, Appraisal, etc.
          allOf:
          - $ref: '#/components/schemas/StatusType'
        liabilities:
          description: Candor analytic related to Liabilities and Credit items.
          allOf:
          - $ref: '#/components/schemas/StatusType'
        assets:
          description: Candor analytic related to Assets, Bank Statements, Large Deposits, etc.
          allOf:
          - $ref: '#/components/schemas/StatusType'
        income:
          description: Candor analytic related to Income, Employment, Paystubs, W2s, etc.
          allOf:
          - $ref: '#/components/schemas/StatusType'
        conditions:
          type: array
          items:
            title: Condition
            properties:
              id:
                type: string
                description: Unique identifier for the condition
              status:
                type: string
                # LoanDepot: Unfulfilled -> 0, Fulfilled -> 1
                enum:
                  - Unfulfilled
                  - Fulfilled
              name:
                type: string
                description: Condition assigned name for condition
              description:
                type: string
                description: Candor provided actual condition verbiage that clearly defines requirements to clear the condition
              priorTo:
                type: string
                description: |
                  - PTA: Prior to Approval, Suspended, Declined
                  - PTD: Prior to Documents
                  - AC: Prior to Closing
                  - PTF: Prior to Funding
                  - Notifications
                # LoanDepot: AC -> PTC
                enum:
                - PTA
                - PTD
                - AC
                - PTF
                - Notifications
              owner:
                type: string
                description: This identifies the responsible party for the condition
                enum:
                - Candor
                - Lender
              category:
                type: string
                description: |
                  - Credit - Identity
                  - Credit - Occupancy
                  - Credit
                  - Income (i.e., Income/Employment)
                  - Assets
                  - Property
                  - Legal (i.e., Legal/Compliance)
                enum:
                - Credit - Identity
                - Credit - Occupancy
                - Credit
                - Income
                - Assets
                - Property
                - Legal
        results:
          type: array
          items:
            title: Candor Result
            properties:
              name:
                type: string
                description: The name of the result document.
              section:
                type: string
                description: A section/folder container for this document.
              base64:
                type: string
                description: The result document binary Base64 encoded.
